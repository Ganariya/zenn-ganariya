---
title: "Pythonのロギング イラスト図解"
emoji: "🔖"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["python", "log", "logging"]
published: false
---

# はじめに

## 対象読者

- [Logging HOWTO](https://docs.python.org/ja/3/howto/logging.html)の初級編は読んでいる方
- [Logging HOWTO](https://docs.python.org/ja/3/howto/logging.html)の上級編に目を軽く通した方

## 内容

- Loggingのコンポーネント
- ロギングの木構造
- ライブラリのおけるロギングの設計

# loggingの存在する意味

Pythonのモジュールである`logging`は、より分かりやすいログの出力をサポートするものです。
`print`を使ってしまうと、どこのファイルからの出力なのかや、どのレベルの出力なのかが分かりづらいです。

致命的なエラーに関する出力なのか、はたまた開発時用にちょっとした変数の中身を見たいだけなのか。
printだけではなかなか判別することができません。

もし`numpy`を使ったとき大量のプリント文が出てきたら、怖いですね。
しかもそれは自分のアプリケーションと標準出力を共有しており、コンソールを余すところなく汚します。
そのため、きちんとログを出力するためにはprintではなくloggingを利用する必要があります。

# loggingのコンポーネント

ここからは上級編の内容を軽く目を通されていることを前提としています。
いくつかの記事で書かれていますが、`logging`モジュール直接ではなく
`getLogger`などを用いて小分けにカスタマイズすることが推奨されているようです。

loggingのコンポーネントは以下のようになっています。

![](https://storage.googleapis.com/zenn-user-upload/tztzukx1j648e6fqafhun1wz24n4)

Loggerは、実際に出力を行うAPIを提供します。
つまり、プログラム上で`logger.info("Hello, world")`のように実際にメッセージを出力する部分に相当します。
ただし、Loggerクラスを実際に使うことは少なく`getLogger`関数を使ってインスタンスを取得します。

Handlerは、どこにログの出力を行うかを決定します。
ターミナルのような標準出力、メールなどにも出力できます。
このHandlerは1つの`logger`インスタンスに複数設定できます。
そのため、loggerインスタンスに標準出力とファイル出力のハンドラを設定すれば、一個のlogger.infoなどで、複数の出力先に書き込めます。

Formatterは、どのような出力形式にするかを規定します。

Filterは、どのようなメッセージ`のみ`を出力するかを選ぶメッセージです。
たとえば、`logger.critical("DB Error")`のようなロガー出力を行うとします。
このとき、もしDBに関するメッセージのみが見たくなったら、DBをメッセージに含むようなものを取り出すフィルタサブクラスを作ればよいです。

LogRecordは、これら4コンポーネントで情報をやりとりするためのものです。
実際にユーザが操作することは少ないと思います。

# 木構造


